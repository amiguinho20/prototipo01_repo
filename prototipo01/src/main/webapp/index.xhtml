<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
</h:head>

<h:body>
	<p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
	<p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
	    <h:graphicImage library="img" name="loadingbar.gif" />
	</p:dialog>

	<h:form id="form">
	
		<p:panel id="panelPesquisa" header="Busca Textual Rápida de Teste" style="margin:20px">
			<h:panelGrid columns="1">
				<p:inputText id="pesquisa" value="#{exemploMB.filtro.pesquisa}" />
				<p:watermark value="Pesquisa Textual" for="pesquisa" />
				<p:commandButton value="Pesquisar"
					actionListener="#{exemploMB.pesquisar}" update="listaDePessoasLazy" />
				<p:commandButton type="button" icon="ui-icon-help"
					onclick="PF('dlg2').show();" />
			</h:panelGrid>
		</p:panel>
		
		<p:dataTable id="listaDePessoasLazy" var="pessoa"
			value="#{exemploMB.pessoasResultadoLazy}"
			lazy="true"
			selection="#{exemploMB.pessoasSelecionadas}" 
			style="margin:20px;" paginator="true"
			paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
			rows="5" rowsPerPageTemplate="5,10,15">
			<f:facet name="header">
            	Pessoas Lazy Load (consulta paginada)
        	</f:facet>
			<p:column selectionMode="multiple" style="width:16px;text-align:center" />
			<p:column headerText="Nome">
				<h:outputText value="#{pessoa.nome}" />
			</p:column>
			<p:column headerText="Ocorrência">
				<h:outputText value="#{pessoa.ocorrencia.formatada}" />
			</p:column> 
			<p:column headerText="Local do Fato">
				<h:outputText value="#{pessoa.ocorrencia.localDoFato.enderecoCompleto}" />
			</p:column>

			<f:facet name="footer">
				<h:outputText value="Total reg. da Pesquisa: #{exemploMB.contagem}   " />
			
				<p:commandButton process="listaDePessoasLazy"
					update="@widgetVar(mapaWidget)"
					actionListener="#{exemploMB.visualizarLocalidades}"
					icon="ui-icon-search" value="Expor no mapa" />
			</f:facet>
		</p:dataTable>
		
 
		<p:panel id="panelMapa" header="Mapa" style="margin:20px">
			<p:gmap id="mapa" widgetVar="mapaWidget"
					center="#{exemploMB.centroMapa}" zoom="9" type="ROADMAP"
					model="#{exemploMB.geoModel}"  
					style="width:100%;height:400px" />
		</p:panel>

		<p:dialog header="Modal Dialog" widgetVar="dlg2" modal="true" height="400" width="600">
			<p>
				<h:outputText value="todas estas palavras" />
				<p:inputText id="txt1" value="#{exemploMB.filtro.todos}" />
			</p>
			<p>
				<h:outputText value="expressao" />
				<p:inputText id="txt2" value="#{exemploMB.filtro.expressao}" />
			</p>
			<p>
				<h:outputText value="qualquer uma destas palavras:" />
				<p:inputText id="txt3" value="#{exemploMB.filtro.ou}" />
			</p>
			<p>
				<h:outputText value="nenhuma destas palavras:" />
				<p:inputText id="txt4" value="#{exemploMB.filtro.nao}" />
			</p>
			<p>
				<p:commandButton value="converter"
					actionListener="#{exemploMB.converter}" update="pesquisa" />
			</p>
		</p:dialog>

	
	</h:form>
</h:body>
</html>
